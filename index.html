<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ZeroTrust Bank â€” Login</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <div class="login-container">
    <h1>ğŸ¦ ZeroTrust Bank</h1>
    <p>Experience browser-based Zero Trust security â€” now with Auth0 login.</p>
    <button id="loginBtn" class="btn">ğŸ” Login with Auth0</button>
    <div id="loginStatus" class="msg"></div>
  </div>

  <!-- âœ… Load Auth0 SDK (latest, reliable CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@2.5.4/dist/auth0-spa-js.production.js"></script>

  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        if (typeof createAuth0Client !== "function") {
          document.getElementById("loginStatus").textContent =
            "âŒ Auth0 SDK failed to load. Please check your internet connection.";
          return;
        }

        const auth0 = await createAuth0Client({
          domain: "dev-qlmmy3wsd6z2uizp.us.auth0.com",       // e.g. dev-abc123.us.auth0.com
          clientId: "MdOH5NIKiGYpDkuGvWhyGkc6wUc6RzV6",  // from Auth0 dashboard
          authorizationParams: {
            redirect_uri: window.location.origin + "/dashboard.html"
          }
        });

        if (window.location.search.includes("code=") &&
            window.location.search.includes("state=")) {
          await auth0.handleRedirectCallback();
          window.history.replaceState({}, document.title, "/dashboard.html");
        }

        const isAuthenticated = await auth0.isAuthenticated();
        const status = document.getElementById("loginStatus");

        if (isAuthenticated) {
          const user = await auth0.getUser();
          console.log("âœ… Logged in as:", user);
          sessionStorage.setItem("ZT_ACTIVE_USER", JSON.stringify(user));
          status.textContent = `âœ… Welcome ${user.name || user.email}`;
          window.location.href = "dashboard.html";
        } else {
          status.textContent = "Please log in to access your dashboard.";
          document.getElementById("loginBtn").addEventListener("click", async () => {
            await auth0.loginWithRedirect();
          });
        }
      } catch (err) {
        console.error("Auth0 initialization error:", err);
        document.getElementById("loginStatus").textContent =
          "âš ï¸ Auth0 initialization failed. Check console for details.";
      }
    });
  </script>
</body>
</html>
