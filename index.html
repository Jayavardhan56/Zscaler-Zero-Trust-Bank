<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ZeroTrust Bank â€” Login</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <div class="login-container">
    <h1>ğŸ¦ ZeroTrust Bank</h1>
    <p>Experience browser-based Zero Trust security â€” now with Auth0 login.</p>

    <button id="loginBtn" class="btn">ğŸ” Login with Auth0</button>

    <div id="loginStatus" class="msg"></div>
  </div>

  <!-- ==================== Scripts ==================== -->
  <!-- Auth0 SDK -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>

  <script>
    // Initialize Auth0 SPA Client
    let auth0Client = null;

    async function configureAuth0() {
      auth0Client = await createAuth0Client({
        domain: "dev-qlmmy3wsd6z2uizp.us.auth0.com",            // ğŸ‘‰ replace with your domain
        clientId: "MdOH5NIKiGYpDkuGvWhyGkc6wUc6RzV6",       // ğŸ‘‰ replace with your client ID
        authorizationParams: {
          redirect_uri: window.location.origin + "/dashboard.html"
        }
      });

      // Handle redirect back from Auth0 after login
      if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
        await auth0Client.handleRedirectCallback();
        window.history.replaceState({}, document.title, "/dashboard.html");
      }

      const isAuthenticated = await auth0Client.isAuthenticated();
      const status = document.getElementById("loginStatus");

      if (isAuthenticated) {
        const user = await auth0Client.getUser();
        console.log("âœ… Logged in as:", user);
        sessionStorage.setItem("ZT_ACTIVE_USER", JSON.stringify(user));
        status.textContent = `Welcome back, ${user.name || user.email}`;
        // Redirect to dashboard
        window.location.href = "dashboard.html";
      } else {
        status.textContent = "Please log in to access your dashboard.";
        document.getElementById("loginBtn").addEventListener("click", async () => {
          await auth0Client.loginWithRedirect();
        });
      }
    }

    window.addEventListener("DOMContentLoaded", configureAuth0);
  </script>
</body>
</html>
